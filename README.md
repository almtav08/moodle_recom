# Hybrid Recommendation System for Moodle

This project is a hybrid recommendation system that combines collaborative filtering and knowledge-based filtering for the Moodle learning platform. It is a result of the Horizon Europe Project e-DIPLOMA (Project number: 101061424, Call: HORIZON-CL2-2021-TRANSFORMATIONS-01, Duration: 01/09/2022 – 31/08/2025).

The complete system consists of three main components:

1. **Recommendation Server** - The main engine that generates recommendations
2. **Moodle Recommendation Block** - Displays recommendations to users
3. **Event Logging Plugin** - Captures user interactions and exposes endpoints for the system

## System Architecture

```
┌───────────────────────┐      ┌───────────────────────┐
│                       │      │                       │
│    Moodle Block       │◄────►│  Logging Plugin       │
│  (hybridrecom_block)  │      │  (logevent_plugin)    │
│                       │      │                       │
└─────────┬─────────────┘      └───────────┬───────────┘
          │                                │
          │                                │
          │                                │
          ▼                                ▼
┌─────────────────────────────────────────────────────┐
│                                                     │
│              Recommendation Server                  │
│               (recommender_server)                  │
│                                                     │
└─────────────────────────────────────────────────────┘
```

## Prerequisites

- Functional Moodle server
- Python 3.8 or higher (for the recommendation server)
- Conda (recommended for Python environment management)
- Database (configured in the .env file)

## 1. Installing the Recommendation Server

The recommendation server is the main component that generates recommendations based on user interactions and the knowledge structure.

### Installation Steps

1. Clone the repository or copy the `recommender_server` folder

2. Create the Python environment with Conda:

   ```bash
   cd recommender_server
   conda env create -f environment.yml
   ```

3. Create a `.env` file in the project root with the following variables:

   ```
   PLATFORM_URL=<Your_Moodle_platform_URL>
   PLATFORM_API_KEY=<Moodle_API_token>
   DATABASE_URL=<Database_URL>
   USER_API_PASS=<User_API_password>
   SEND_MESSAGES_FUNC=<Send_messages_function_URL>
   GET_USER_QUIZ_ATTEMPTS=<Quiz_attempts_function_URL>
   GET_USER_ATTEMPT_REVIEW=<Attempts_review_function_URL>
   GET_COURSE_CONTENTS=<Course_contents_function_URL>
   GET_COURSE_INFO=<Course_info_function_URL>
   GET_ENROLLED_STUDENTS=<Enrolled_students_function_URL>
   GET_COURSE_LOGS=<Course_logs_function_URL>
   ```

4. Load data into the database and prepare the knowledge graph by executing the scripts in this order:

   ```bash
   python load_resources_data.py
   python load_users_data.py
   python load_interaction_data.py
   python load_db.py
   python load_prevgraph_data.py
   python load_repeatgraph_data.py
   ```

   **Note**: During the execution of `load_resources_data.py`, a window will appear where you should select which Moodle resources will be included in the recommendation process.

   **Note**: While loading the graphs, you will need to indicate the related items separated by commas (e.g., Moodle ID: 1, Module Name: 'Introduction', Related Entities: 2,3,4).

5. Start the server:

   ```bash
   conda activate <environment_name>
   uvicorn main:app --host <your_ip> --port <your_port>
   ```

   For development, you can add the `--reload` option for the server to automatically restart when detecting code changes.

## 2. Installing the Moodle Recommendation Block

This block displays the recommendations generated by the server to Moodle users.

### Installation Steps

1. Copy the `hybridrecom_block` folder to the `blocks` directory of your Moodle installation:

   ```
   path_to_your_moodle/blocks/
   ```

2. Access the Moodle site as administrator

3. Moodle will automatically detect the new block and display installation instructions

4. Configure the block with:
   - Recommendation server URL (the same IP and port configured in step 5 of the server installation)
   - Number of recommendations to display in the block

## 3. Installing the Event Logging Plugin

This plugin records user interactions with resources and provides endpoints that the recommendation server uses.

### Installation Steps

1. Copy the `logevent_plugin` folder to the `local` directory of your Moodle installation:

   ```
   path_to_your_moodle/local/
   ```

2. Access the Moodle site as administrator

3. Moodle will automatically detect the new plugin and display installation instructions

4. Configure the plugin with the recommendation server URL (it must be the same as configured in the recommendation block)

## Installation Verification

To verify that all components are correctly installed and configured:

1. Make sure the recommendation server is running
2. Log in to Moodle as a student
3. Navigate to a course and verify that the recommendation block is displayed correctly
4. Interact with some resources and verify that these interactions are being recorded (this can be checked in the recommendation server logs)

## Troubleshooting

If you encounter problems during installation or use of the system:

- Verify that the URLs configured in each component are correct
- Check the recommendation server logs to identify possible errors
- Make sure all prerequisites are correctly installed
- Verify that the directory permissions in Moodle are adequate

## Contact Information

If you have any questions, you can contact:

- Alex Martínez-Martínez: [alemarti@uji.es](mailto:alemarti@uji.es)

## Contributions

This system was developed by Alex Martínez-Martínez as part of his research at the Institute of New Imaging Technologies at Universitat Jaume I.

**Co-authors**: Águeda Gómez-Cambronero, Raul Montoliu, and Inmaculada Remolar.

## Related Repositories

- Recommendation Block: [https://github.com/almtav08/moodle_recommender_block](https://github.com/almtav08/moodle_recommender_block)
- Event Logging Plugin: [https://github.com/almtav08/moodle_recommender_plugin](https://github.com/almtav08/moodle_recommender_plugin)
- Recommendation Server: [https://github.com/almtav08/recom_server](https://github.com/almtav08/recom_server)
